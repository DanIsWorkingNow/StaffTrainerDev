import{u as P,n as V,r as j,j as e,c as G,a as _}from"./main-0TgHznNF.js";const q=_("59225030f70e54fd37c513636de9238a7b9d1cefd89c7c673f910f3c6e507824"),H=G({method:"POST"}).handler(q),U=_("9eed1a3f7f261d3e01b9930bb3e5c7652207455ed8ee8cce7136d0e65a84d802"),K=G({method:"POST"}).handler(U);function Q(){const t=[],n={ANGGERIK:"bg-purple-100 border-purple-300",BOUGANVILLA:"bg-pink-100 border-pink-300",RAFLESIA:"bg-red-100 border-red-300",SEROJA:"bg-yellow-100 border-yellow-300",LESTARI_4:"bg-green-100 border-green-300",LESTARI_5:"bg-teal-100 border-teal-300",LESTARI_6:"bg-cyan-100 border-cyan-300"};["ANGGERIK","BOUGANVILLA","RAFLESIA"].forEach(r=>{const d=[],c=[];for(let l=1;l<=8;l++)c.push({id:`${r}-G-${l}`,roomNumber:l,capacity:2,building:r,floor:0,type:"standard"});d.push({floorNumber:0,floorName:"Ground Floor",rooms:c});for(let l=1;l<=3;l++){const m=[];for(let g=1;g<=24;g++)m.push({id:`${r}-F${l}-${g}`,roomNumber:g,capacity:2,building:r,floor:l,type:"standard"});d.push({floorNumber:l,floorName:`Floor ${l}`,rooms:m})}t.push({name:r,type:"standard",displayName:r,color:n[r],floors:d})});const i=[],o=[];for(let r=1;r<=8;r++)o.push({id:`SEROJA-G-${r}`,roomNumber:r,capacity:2,building:"SEROJA",floor:0,type:"standard"});i.push({floorNumber:0,floorName:"Ground Floor",rooms:o});const u=[];for(let r=1;r<=24;r++)u.push({id:`SEROJA-F1-${r}`,roomNumber:r,capacity:1,building:"SEROJA",floor:1,type:"vip"});i.push({floorNumber:1,floorName:"Floor 1 (VIP)",rooms:u});for(let r=2;r<=3;r++){const d=[];for(let c=1;c<=24;c++)d.push({id:`SEROJA-F${r}-${c}`,roomNumber:c,capacity:2,building:"SEROJA",floor:r,type:"standard"});i.push({floorNumber:r,floorName:`Floor ${r}`,rooms:d})}return t.push({name:"SEROJA",type:"vip",displayName:"SEROJA (VIP)",color:n.SEROJA,floors:i}),["LESTARI_4","LESTARI_5","LESTARI_6"].forEach((r,d)=>{const c=[],l=[];for(let m=1;m<=15;m++)l.push({id:`${r}-H${m}`,roomNumber:m,capacity:8,building:r,floor:0,type:"quarters"});c.push({floorNumber:0,floorName:"Houses",rooms:l}),t.push({name:r,type:"quarters",displayName:`LESTARI ${d+4}`,color:n[r],floors:c})}),t}function Y(){const t=P(),{assignments:n,trainers:p,stats:i}=V.useLoaderData(),[o,u]=j.useState(""),[b,r]=j.useState("all"),[d,c]=j.useState(""),[l,m]=j.useState(""),[g,S]=j.useState(""),[f,A]=j.useState(!1),[h,N]=j.useState(!1),v=n.reduce((s,a)=>{const x=a.room_id;return s[x]||(s[x]=[]),s[x].push(a),s},{}),w=Q(),E=o===""?null:w.find(s=>s.name===o),k=E?E.floors:[],I=(()=>{const s=[];return w.forEach(a=>{a.floors.forEach(x=>{x.rooms.forEach(y=>{s.push({...y,buildingDisplayName:a.displayName,buildingColor:a.color,floorName:x.floorName,assignments:v[y.id]||[]})})})}),s})(),T=o===""?[]:I.filter(s=>{const a=s.building===o,x=b==="all"||s.floor===b;return!a||!x?!1:d?s.assignments.some(y=>y.trainer?.name.toLowerCase().includes(d.toLowerCase())):!0}),$=p.filter(s=>!n.some(a=>a.trainer?.id===s.id)),D=async()=>{if(!l||!g){alert("Please select both a trainer and a room");return}A(!0);try{await H({data:{trainerId:parseInt(l),roomId:g}}),m(""),S(""),await t.invalidate()}catch(s){alert("Failed to assign trainer: "+s.message)}finally{A(!1)}},J=async s=>{if(confirm("Are you sure you want to remove this trainer from the room?")){N(!0);try{await K({data:{assignmentId:s}}),await t.invalidate()}catch(a){alert("Failed to remove trainer: "+a.message)}finally{N(!1)}}},O=s=>{u(s),r("all")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Dormitory Management"}),e.jsx("p",{className:"text-gray-600",children:"Select a building below to view and manage room assignments"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(L,{title:"Total Rooms",value:i.totalRooms,icon:"ðŸ¢",color:"bg-blue-500"}),e.jsx(L,{title:"Occupied Rooms",value:i.occupiedRooms,icon:"ðŸ”’",color:"bg-green-500"}),e.jsx(L,{title:"Available Rooms",value:i.availableRooms,icon:"ðŸ”“",color:"bg-yellow-500"}),e.jsx(L,{title:"Occupancy Rate",value:`${i.occupancyRate}%`,icon:"ðŸ“Š",color:"bg-purple-500"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Select a Building"}),e.jsx("p",{className:"text-gray-600 mb-4 text-sm",children:"Click on any building below to view its room layout"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4",children:w.map(s=>{const a=I.filter(R=>R.building===s.name),x=a.reduce((R,F)=>R+F.capacity,0),y=a.reduce((R,F)=>R+F.assignments.length,0),C=Math.round(y/x*100),B=o===s.name;return e.jsxs("div",{className:`${s.color} rounded-lg p-4 cursor-pointer hover:shadow-lg hover:scale-105 transition-all ${B?"ring-4 ring-blue-600 shadow-lg scale-105":"hover:ring-2 hover:ring-blue-400"}`,onClick:()=>O(s.name),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-bold text-lg",children:s.displayName}),B&&e.jsx("span",{className:"bg-blue-600 text-white text-xs px-2 py-1 rounded-full",children:"Selected"})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{className:"text-gray-700",children:[s.type==="quarters"?"Houses":"Rooms",": ",a.length]}),e.jsxs("p",{className:"text-gray-700",children:["Capacity: ",x]}),e.jsxs("p",{className:"text-gray-700",children:["Occupied: ",y]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all",style:{width:`${C}%`}})}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:[C,"% occupied"]})]})]})]},s.name)})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Assign Trainer to Dormitory"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Trainer"}),e.jsxs("select",{value:l,onChange:s=>m(s.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:f||h,children:[e.jsx("option",{value:"",children:"Select Trainer"}),$.map(s=>e.jsxs("option",{value:s.id,children:[s.name," - ",s.rank]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Room/House"}),e.jsxs("select",{value:g,onChange:s=>S(s.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:f||h,children:[e.jsx("option",{value:"",children:"Select Room"}),I.filter(s=>s.assignments.length<s.capacity).map(s=>{const a=s.type==="quarters"?`${s.buildingDisplayName} - House ${s.roomNumber}`:`${s.buildingDisplayName} - ${s.floorName} - Room ${s.roomNumber}`;return e.jsxs("option",{value:s.id,children:[a," (",s.assignments.length,"/",s.capacity,")",s.type==="vip"?" - VIP":""]},s.id)})]})]}),e.jsx("div",{children:e.jsx("button",{onClick:D,disabled:f||h||!l||!g,className:"w-full px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:f?"Assigning...":"Assign"})})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Filters"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("input",{type:"text",placeholder:o===""?"Select a building first...":"Search by trainer name...",value:d,onChange:s=>c(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",disabled:o===""}),e.jsxs("select",{value:o,onChange:s=>O(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select a Building First"}),e.jsxs("optgroup",{label:"Standard Dormitories",children:[e.jsx("option",{value:"ANGGERIK",children:"ANGGERIK"}),e.jsx("option",{value:"BOUGANVILLA",children:"BOUGANVILLA"}),e.jsx("option",{value:"RAFLESIA",children:"RAFLESIA"})]}),e.jsx("optgroup",{label:"VIP Dormitory",children:e.jsx("option",{value:"SEROJA",children:"SEROJA (VIP)"})}),e.jsxs("optgroup",{label:"Quarters",children:[e.jsx("option",{value:"LESTARI_4",children:"LESTARI 4"}),e.jsx("option",{value:"LESTARI_5",children:"LESTARI 5"}),e.jsx("option",{value:"LESTARI_6",children:"LESTARI 6"})]})]}),e.jsxs("select",{value:b,onChange:s=>r(s.target.value==="all"?"all":parseInt(s.target.value)),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",disabled:o==="",children:[e.jsx("option",{value:"all",children:o===""?"Select building first":"All Floors"}),k.map(s=>e.jsx("option",{value:s.floorNumber,children:s.floorName},s.floorNumber))]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:o!==""?`${E?.displayName} - ${T.length} ${E?.type==="quarters"?"houses":"rooms"}`:"Room Layout - Please select a building"}),o===""?e.jsxs("div",{className:"text-center py-16 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ¢"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-700 mb-2",children:"Select a Building to View Rooms"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Click on a building card above or use the dropdown filter to get started"}),e.jsxs("div",{className:"flex justify-center gap-2 text-sm text-gray-500",children:[e.jsx("span",{children:"ðŸ“"}),e.jsxs("span",{children:["Available: ",w.length," buildings â€¢ ",I.length," rooms"]})]})]}):T.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ”"}),e.jsx("p",{className:"text-gray-600",children:"No rooms found matching your filters"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:T.map(s=>e.jsx(M,{room:s,onRemove:J,isRemoving:h},s.id))})]}),$.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4",children:["Unassigned Trainers (",$.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:$.map(s=>e.jsx("div",{className:"p-4 border border-yellow-300 bg-yellow-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-yellow-200 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xl",children:"âš ï¸"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.rank})]})]})},s.id))})]})]})}function L({title:t,value:n,icon:p,color:i}){return e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:t}),e.jsx("p",{className:"text-3xl font-bold",children:n})]}),e.jsx("div",{className:`${i} w-16 h-16 rounded-full flex items-center justify-center text-3xl`,children:p})]})})}function M({room:t,onRemove:n,isRemoving:p}){const{id:i,roomNumber:o,capacity:u,assignments:b,buildingDisplayName:r,buildingColor:d,floorName:c,type:l}=t,g=`${b.length}/${u}`,S=Array.from({length:u},(h,N)=>{const v=b[N];return{slotNumber:N+1,assignment:v||null,trainer:v?.trainer||null,occupied:!!v}});let f="grid-cols-2";u===1&&(f="grid-cols-1"),u===8&&(f="grid-cols-4");const A=l==="quarters"?`House ${o}`:`Room ${o}`;return e.jsxs("div",{className:`border-2 ${d} rounded-lg p-4 hover:shadow-md transition-shadow`,children:[e.jsxs("div",{className:"mb-3 border-b pb-2",children:[e.jsx("h3",{className:"text-base font-bold text-gray-900",children:r}),e.jsxs("p",{className:"text-sm text-gray-700",children:[c," - ",A]}),e.jsxs("p",{className:"text-xs text-gray-600",children:[g," ",l==="vip"?"(VIP)":l==="quarters"?"(Quarters)":""]})]}),e.jsx("div",{className:`grid ${f} gap-2 mb-3`,children:S.map(h=>e.jsx(z,{slotNumber:h.slotNumber,trainer:h.trainer,assignment:h.assignment,occupied:h.occupied,onRemove:n,isRemoving:p,isQuarters:l==="quarters"},h.slotNumber))})]})}function z({slotNumber:t,trainer:n,assignment:p,occupied:i,onRemove:o,isRemoving:u,isQuarters:b}){return i&&n&&p?e.jsxs("div",{className:"bg-red-100 border border-red-300 rounded p-2 min-h-[60px] flex flex-col items-center justify-center transition-colors hover:bg-red-200 relative group",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-800 text-center leading-tight break-words",children:n.name}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:n.rank}),e.jsx("button",{onClick:()=>o(p.id),disabled:u,className:"absolute top-0 right-0 -mt-1 -mr-1 bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-700 disabled:bg-gray-400 disabled:cursor-not-allowed",title:"Remove trainer",children:"Ã—"})]}):e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded p-2 min-h-[60px] flex flex-col items-center justify-center transition-colors hover:bg-blue-100",children:[e.jsx("span",{className:"text-gray-400 text-2xl font-light",children:"â€”"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:b?`Bed ${t}`:`Bed ${t}`})]})}export{Y as component};
